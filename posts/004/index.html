<!DOCTYPE html><html lang="ja"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@handle"/><meta property="og:type" content="website"/><meta property="og:image:alt" content="Og Image Alt"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="512"/><meta property="og:image:height" content="512"/><meta property="og:site_name" content="blog"/><link rel="icon" href="../../favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="../../favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="../../favicons/favicon-32x32.png"/><link rel="apple-touch-icon" sizes="180x180" href="../../favicons/apple-touch-icon-180x180.png"/><link rel="mask-icon" href="../../favicons/safari-pinned-tab.svg" color="#5bbad5"/><title>サークルのシフトを線形最適化で決める</title><meta name="robots" content="index,follow"/><meta name="description" content="python-MIPを用いたシフトスケジューリング最適化"/><meta property="og:title" content="サークルのシフトを線形最適化で決める"/><meta property="og:description" content="python-MIPを用いたシフトスケジューリング最適化"/><meta property="og:url" content="http://blog.maltonn.com/"/><meta property="og:image" content="http:/blog.maltonn.com/assets/blog/004/thumbnail.png"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/b0b711a4115e75bd.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b0b711a4115e75bd.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7b203be1511c3192.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7b203be1511c3192.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-df4cf1c8d23aa877.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-b680bac5455cc527.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c4722284344b12da.js" defer=""></script><script src="/_next/static/chunks/252f366e-75931ac92edbacfb.js" defer=""></script><script src="/_next/static/chunks/585-83005a2f4ef3db45.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-35fbc23a53e348bc.js" defer=""></script><script src="/_next/static/itYJbJc-on64ttulGuxbe/_buildManifest.js" defer=""></script><script src="/_next/static/itYJbJc-on64ttulGuxbe/_ssgManifest.js" defer=""></script><script src="/_next/static/itYJbJc-on64ttulGuxbe/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div style="grid-template-rows:auto 1fr auto" class="grid gap-10 min-h-screen bg-global"><div class="sticky top-0 z-10 py-3 bg-primary-1 shadow-sm p-6"><div class="container xl:max-w-7xl mx-auto"><nav class="hstack justify-between"><a class="select-none text-primary-1 text-2xl md:text-3xl font-bold" href="/">Malton Blog</a><div class="hidden lg:flex"><a class="px-5 py-2 text-primary-1 capitalize select-none cursor-pointer" href="/tags/">tags</a><a class="px-5 py-2 text-primary-1 capitalize select-none cursor-pointer" href="/about/">about</a></div><div class="flex gap-4"><button type="button" class="icon-btn" aria-label="toggle theme"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div></nav></div></div><div class="px-0 py-6 sm:p-6 p-6"><div class="container xl:max-w-7xl mx-auto"><div class="grid grid-cols-1 lg:grid-cols-3 gap-10"><div class="lg:col-span-2"><main><article><div class="p-8 bg-primary-1"><div class="vstack gap-4"><div class="w-full h-64 sm:h-80"><img src="../../assets/blog/004/thumbnail.png" alt="Cover Image for サークルのシフトを線形最適化で決める" class="w-full h-full object-cover"/></div><h1 class="text-primary-1 text-3xl md:text-4xl font-bold tracking-tighter leading-tight">サークルのシフトを線形最適化で決める</h1><div class="wrap gap-4"><div class="select-none hstack gap-2 text-md font-medium text-accent-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" d="M0 0h24v24H0z"></path><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm1-10V7h-2v7h6v-2h-4z"></path></g></svg>2023/11/22</div><div class="wrap gap-2"><span class="select-none text-primary-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M477.5 694l311.9-311.8-19-224.6-224.6-19-311.9 311.9L477.5 694zm116-415.5a47.81 47.81 0 0 1 33.9-33.9c16.6-4.4 34.2.3 46.4 12.4a47.93 47.93 0 0 1 12.4 46.4 47.81 47.81 0 0 1-33.9 33.9c-16.6 4.4-34.2-.3-46.4-12.4a48.3 48.3 0 0 1-12.4-46.4z"></path><path d="M476.6 792.6c-1.7-.2-3.4-1-4.7-2.3L137.7 456.1a8.03 8.03 0 0 1 0-11.3L515.9 66.6c1.2-1.3 2.9-2.1 4.7-2.3h-.4c-2.3-.2-4.7.6-6.3 2.3L135.7 444.8a8.03 8.03 0 0 0 0 11.3l334.2 334.2c1.8 1.9 4.3 2.6 6.7 2.3z"></path><path d="M889.7 539.8l-39.6-39.5a8.03 8.03 0 0 0-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 0 0-11.3 0l-39.6 39.5a8.03 8.03 0 0 0 0 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3zM652.3 337.3a47.81 47.81 0 0 0 33.9-33.9c4.4-16.6-.3-34.2-12.4-46.4a47.93 47.93 0 0 0-46.4-12.4 47.81 47.81 0 0 0-33.9 33.9c-4.4 16.6.3 34.2 12.4 46.4a48.3 48.3 0 0 0 46.4 12.4z"></path><path d="M137.7 444.8a8.03 8.03 0 0 0 0 11.3l334.2 334.2c1.3 1.3 2.9 2.1 4.7 2.3 2.4.3 4.8-.5 6.6-2.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3h-1.6c-1.8.2-3.4 1-4.7 2.3L137.7 444.8zm408.1-306.2l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9z"></path></svg></span><a class="badge" href="/tags/%E9%96%8B%E7%99%BA/">開発</a><a class="badge" href="/tags/pickup/">pickup</a></div></div></div><div class="post"><div class="markdown-styles_markdown__BegJd"><h2 id="tldr"><a aria-hidden="true" tabindex="-1" href="#tldr"><span class="icon icon-link"></span></a>TL;DR</h2>
<p>数理最適化を用いてシフトスケジューリング問題を解いたよ。多くの要望を考慮したシフトをシステマティックに作成することができたよ。</p>
<h2 id="はじめに"><a aria-hidden="true" tabindex="-1" href="#はじめに"><span class="icon icon-link"></span></a>はじめに</h2>
<p>所属サークルの一つである大阪大学お嬢様部が学祭に出店することになり、そのシフト担当になりました。
というわけで、前からやってみたかったシフトスケジューリング問題の実践投入をしてみました。<br>
なお、個人情報保護や説明のしやすさの観点から、一部詳細を変更しています。</p>
<h2 id="お嬢様部とは"><a aria-hidden="true" tabindex="-1" href="#お嬢様部とは"><span class="icon icon-link"></span></a>お嬢様部とは</h2>
<p>もともとはtwitter上で語尾に「～ですわ」を付けるだけの小規模ネットミームでしたが、とある阪大生が「本当にサークルとして存在したら面白くね？」と思いついて大阪大学お嬢様部が生まれました。順調に運営が続き、現在アクティブ部員30名越えの中堅サークルにまで発展しています。大阪大学お嬢様部について詳しくは<a href="https://twitter.com/OU_ojousamaclub">Twitter</a> もしくは <a href="https://ou-ojousamaclub.com/">公式ホームページ</a>をご覧ください。<br>
余談ですが弊大学以外の名を冠したお嬢様部もたくさん存在します。よかったら調べてみてください。</p>
<h2 id="線形最適化線形計画法とは"><a aria-hidden="true" tabindex="-1" href="#線形最適化線形計画法とは"><span class="icon icon-link"></span></a>線形最適化(線形計画法)とは</h2>
<p><code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>a</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>a</mi><mi>n</mi></msub><msub><mi>x</mi><mi>n</mi></msub><mo>≤</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a_1x_1+a_2x_2+....a_nx_n \leq b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"></span><span class="mord">....</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></code><br>
という条件（複数あってもよい）のもとで<br>
<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><msub><mi>c</mi><mn>1</mn></msub><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>c</mi><mi>m</mi></msub><msub><mi>x</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">E= c_1x_1+c_2x_2+...c_mx_m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord">...</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></code><br>
を最小化する問題を解くことです。<br>
NP困難な問題ですが、単体法・内点法などのヒューリスティックアルゴリズムで現実的に高速に解くことができます。</p>
<p>なお、一部の変数が整数でなければならないという制約があると「混合整数線形計画問題（MIP）」と呼ばれる問題となり、今回もこれにあたります。 具体的にシフトをどのように不等式に落とし込むかは後述。</p>
<h2 id="前提知識"><a aria-hidden="true" tabindex="-1" href="#前提知識"><span class="icon icon-link"></span></a>前提知識</h2>
<p>弊サークルでは部員がロールプレイをしてお客様をもてなすのですが、それゆえ、少し複雑な要件があります。
<img src="../../assets/blog/004/1.png" alt="部員-ロール-ポジションの関係">
部員にはそれぞれ、ロールの希望とポジションの希望があり、また、企画のコンセプトとして「このポジションにはこのロールを当てたい」というような運営側の希望があります。さらに、【この時間は全員が執事です】みたいな時間が出来ちゃうとギャグなので避けたい、というようなアンチパターンがいくつかあり考慮に入れる必要があります。<br>
人の手でこれらを総合してうまいこと組むのは至難の業であり、ここで数理最適化の強みが出ます。</p>
<h2 id="開発"><a aria-hidden="true" tabindex="-1" href="#開発"><span class="icon icon-link"></span></a>開発</h2>
<h3 id="データの用意"><a aria-hidden="true" tabindex="-1" href="#データの用意"><span class="icon icon-link"></span></a>データの用意</h3>
<p>Google Form でシフト希望アンケートを取ったのち、Excelに落とし込みます。ポジション/ロールの希望については選択式なので簡単ですが、時間の希望については自由記述を定型データに落とし込む必要がありそれなりに骨が折れる作業でした。次回以降の課題の一つです。
<img src="../../assets/blog/004/2.png" alt="希望調査表">
時間/ロール/ポジションの希望調査に運営から聞いたレギュレーションを追加して4つの表が出来上がりました。<br>
なお、実際には30部員・20時間（40コマ）・13ポジション・4ロールを扱う必要があり、それなりに大きな表になります。</p>
<h3 id="コストの定義"><a aria-hidden="true" tabindex="-1" href="#コストの定義"><span class="icon icon-link"></span></a>コストの定義</h3>
<p>pandasにはExcelの表を読みだしてそのままDataFrameにしてくれる機能があります。そこからさらにndarrayに変換して、○△×を適切なコストで置換してやれば<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>P</mi><mo stretchy="false">[</mo><mtext>部員番号</mtext><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mtext>ポジション</mtext><mi>I</mi><mi>D</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>コスト</mtext></mrow><annotation encoding="application/x-tex">WP[部員番号][ポジションID]=コスト</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">[</span><span class="mord cjk_fallback">部員番号</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord cjk_fallback">ポジション</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">コスト</span></span></span></span></code>となるようなコスト表が出来上がります。他の要素についても同様。<br>
後から出てきますが、シフト計画はこれらの合計を最小化するように立てるので、【〇】のコストを小さく、【×】のコストを大きくするのが良いです。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
WP_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data.xlsx'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'ポジション'</span><span class="token punctuation">)</span>
WP <span class="token operator">=</span> WP_df<span class="token punctuation">.</span>values
WP<span class="token punctuation">[</span>WP<span class="token operator">==</span><span class="token string">"〇"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>
WP<span class="token punctuation">[</span>WP<span class="token operator">==</span><span class="token string">"△"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">10</span>
WP<span class="token punctuation">[</span>WP<span class="token operator">==</span><span class="token string">"×"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">10000000</span>
</code></pre>
<p>これらの積を取って、部員・ポジション・ロール・時間が与えられたときのコスト行列を定義します。
やや効率の悪いやり方をしているように思えますが、せいぜい部員×ポジション×時間の<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></code>オーダーしか回らないこと、実際には細かい要望に合わせてcost関数を変更する必要があること等が理由でこの形に落ち着きました。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">cost</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> w<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> p<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> t<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>WT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>WP<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">]</span><span class="token operator">*</span>self<span class="token punctuation">.</span>RP<span class="token punctuation">[</span>r<span class="token punctuation">,</span>p<span class="token punctuation">]</span>

WPT<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>wnum<span class="token punctuation">,</span>self<span class="token punctuation">.</span>pnum<span class="token punctuation">,</span>self<span class="token punctuation">.</span>tnum<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>wnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>tnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
            WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token operator">=</span>self<span class="token punctuation">.</span>cost<span class="token punctuation">(</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>role_WD<span class="token punctuation">[</span>w<span class="token punctuation">,</span>self<span class="token punctuation">.</span>time2day<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span>

</code></pre>
<p>目ざとい読者はお気づきかもしれませんが、コスト行列にロール要素が含まれていません。これは、当初WPRTの4軸で実装したところ変数と条件の数があまりに多く一向に有効解が見つからなかったため、諦めてロールを決め打ちしたという事情があります。（role_WDがこれにあたり、<code>role_WD[部員番号,企画日何日目か] = その日のロール</code>）なる行列をあらかじめ定義しました。）</p>
<h3 id="モデルの作成と変数定義と"><a aria-hidden="true" tabindex="-1" href="#モデルの作成と変数定義と"><span class="icon icon-link"></span></a>モデルの作成と変数定義と</h3>
<p>python-MIPを使ってモデルと変数を作ります。
（説明の見やすさのため、変数名を一文字にしていますが実際は<code>var_WPT</code>みたいな名前を付けてます。命名のベストプラクティスはなんも分らん）</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> mip
m<span class="token operator">=</span>mip<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token string">"ShiftScheduling"</span><span class="token punctuation">)</span>

X<span class="token operator">=</span>m<span class="token punctuation">.</span>add_var_tensor<span class="token punctuation">(</span><span class="token punctuation">(</span>wnum<span class="token punctuation">,</span>pnum<span class="token punctuation">,</span>tnum<span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">"worker-place-time"</span><span class="token punctuation">,</span>var_type<span class="token operator">=</span><span class="token string">"B"</span><span class="token punctuation">)</span>
</code></pre>
<p>python-MIPではadd_var_tensorメソッドによって多次元配列の変数集合を作ることができます。
今回は 部員番号を<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span></code>,ポジション番号を<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></code>,時間セクション番号を<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></code>として、<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy="false">[</mo><mi>w</mi><mo separator="true">,</mo><mi>p</mi><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">]</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>その部員がその時間にそのポジションに入る場合</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">X[w,p,t] = \begin{cases} 1 &#x26; \text{その部員がその時間にそのポジションに入る場合} \\0 &#x26; \text{otherwise}\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">その部員がその時間にそのポジションに入る場合</span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">otherwise</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></code>  なる変数行列をつくりました。これにより、各種条件をシンプルに書くことが可能になります。　　</p>
<h3 id="目的関数"><a aria-hidden="true" tabindex="-1" href="#目的関数"><span class="icon icon-link"></span></a>目的関数</h3>
<p>各セルのコストと変数が決まったため、線形計画問題に落とし込む準備ができました。
今回は<code>E= X*SC.WPT</code>の合計値の最小化を目指します。これはすなわち、<code>X[w,p,t]==1</code>となる（＝部員<code>w</code>がポジション<code>p</code>、時刻<code>t</code>でポジションに入るときの）<code>w,p,t</code>のコストの合計値を最小化する事と同義です。</p>
<pre class="language-python"><code class="language-python">m<span class="token punctuation">.</span>objective <span class="token operator">=</span> mip<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token operator">*</span>SC<span class="token punctuation">.</span>WPT<span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="制約条件"><a aria-hidden="true" tabindex="-1" href="#制約条件"><span class="icon icon-link"></span></a>制約条件</h3>
<p>このままでは、「全時間誰も入らないのがコスト0で一番いいね！」となってしまします。そういうわけにはいかないので、必要な制約条件を追加してきます。
python-MIPでは<code>m+=条件</code>という形で制約条件を追加することができます。かなり思いきった演算子オーバーロードです。</p>
<h4 id="どの時間もどの場所もちゃんとシフトの人を入れる"><a aria-hidden="true" tabindex="-1" href="#どの時間もどの場所もちゃんとシフトの人を入れる"><span class="icon icon-link"></span></a>どの時間もどの場所もちゃんとシフトの人を入れる</h4>
<p>「すべての時間tとポジションpについて、w方向に圧縮した場合（部員を問わない場合）常に1となる」と読みかえて式に落とします。</p>
<pre class="language-python"><code class="language-python">  <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
          m <span class="token operator">+=</span> mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
</code></pre>
<h4 id="一人二役の禁止"><a aria-hidden="true" tabindex="-1" href="#一人二役の禁止"><span class="icon icon-link"></span></a>一人二役の禁止</h4>
<p>ある時間に同じ人が異なる2か所のポジションに入ってしまうと大変なことになります。制約条件として「任意の時間t,部員wについて<code>X[w,p,t]=1</code>なるpは最大一つ」⇔「p方向に圧縮した合計値が1以下」を追加します。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">+=</span> mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span>w<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&#x3C;=</span> <span class="token number">1</span>
</code></pre>
<h3 id="完成"><a aria-hidden="true" tabindex="-1" href="#完成"><span class="icon icon-link"></span></a>完成！</h3>
<p>破綻のないシフト計画が完成しました！<br>
（実際のシフトは個人情報保護のため割愛）</p>
<h2 id="要望とかに答えるフェーズ"><a aria-hidden="true" tabindex="-1" href="#要望とかに答えるフェーズ"><span class="icon icon-link"></span></a>要望とかに答えるフェーズ</h2>
<p>出来上がったシフト表をよく見ると色々と文句の付け所があることに気づきます。この節では文句/要望とそれにどう対応したかを紹介します。</p>
<h3 id="全員執事みたいなギャグを避けるために"><a aria-hidden="true" tabindex="-1" href="#全員執事みたいなギャグを避けるために"><span class="icon icon-link"></span></a>「全員執事」みたいなギャグを避けるために</h3>
<p>任意の時間で、どこかのポジションはお嬢様ロールが入っていなくてはならないという制約を追加します。お嬢様ロールの部員のみを抜き取って、時間を固定したときの合計が1以上になればよいです。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ojousama_lst<span class="token operator">=</span><span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wnum<span class="token punctuation">)</span> <span class="token keyword">if</span> role_WD<span class="token punctuation">[</span>w<span class="token punctuation">,</span>t2d<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">==</span>ridx<span class="token punctuation">(</span><span class="token string">"お嬢様"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    m<span class="token operator">+=</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span>ojousama_lst<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">1</span>
</code></pre>
<p>リストをインデックスにできるnumpy式スライシングの便利さに感動。</p>
<h3 id="連続時間制約"><a aria-hidden="true" tabindex="-1" href="#連続時間制約"><span class="icon icon-link"></span></a>連続時間制約</h3>
<p>機械は感情がないので、「部員によっては1日中休憩なし」みたいな血も涙もないシフトを出してきます。そこで、3時間以上連続でシフトに入れることを禁止する制約を付けます。
30分1コマなので任意の時刻<code>t</code>において<code>t</code>から<code>t+6</code>までの合計値が5以下であればよいです。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tnum<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        m<span class="token operator">+=</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>var_WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>t<span class="token punctuation">:</span>t<span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&#x3C;=</span><span class="token number">5</span>
</code></pre>
<h3 id="さんだけ働かせすぎじゃない問題"><a aria-hidden="true" tabindex="-1" href="#さんだけ働かせすぎじゃない問題"><span class="icon icon-link"></span></a>○○さんだけ働かせすぎじゃない？問題</h3>
<p>シフト時間ができるだけ公平になるような制約/目的関数を追加します。<br>
できるだけ公平と聞いてまず思いつくのは分散最小化ですが、これはXについての2次式となり、目的関数や制約条件に落とし込むことができません。そこで、「最もシフトに長くいる人のシフト入り時間の最小化」をすることで、不公平に働きすぎる人を抑えようというアプローチをとります。<br>
最小値の最大化は線形計画法の鉄板テクニックで、新たな中間変数zを用意して<br>
<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>minimize: </mtext><mi>max</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><msub><mi>Y</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{minimize: } \max{(Y_n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">minimize: </span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></code><br>
<code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⇔</mo><mtext>minimize: </mtext><mi>z</mi><mtext> subject to </mtext><msub><mi>Y</mi><mi>n</mi></msub><mo>≤</mo><mi>z</mi><mtext> for all </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">\Leftrightarrow \text{minimize: } z \text{ subject to } Y_n \leq z \text{ for all } n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">⇔</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">minimize: </span></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord text"><span class="mord"> subject to </span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord text"><span class="mord"> for all </span></span><span class="mord mathnormal">n</span></span></span></span></code><br>
と読み替えることで線形式に落とし込めます。</p>
<pre class="language-python"><code class="language-python">z<span class="token operator">=</span>m<span class="token punctuation">.</span>add_var<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"max_shift_time"</span><span class="token punctuation">,</span>var_type<span class="token operator">=</span><span class="token string">"I"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>objective <span class="token operator">=</span> mip<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>
                  mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token operator">*</span>SC<span class="token punctuation">.</span>WPT<span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
                <span class="token operator">+</span> z <span class="token comment">#新たに導入する中間変数</span>
                <span class="token punctuation">)</span> 
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">+=</span> mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span>w<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&#x3C;=</span> z
</code></pre>
<p>また、重みを付けて一部の部員の制限を緩くしたり厳しくしたりもできます。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r<span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">if</span> w<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">:</span> 
        r<span class="token operator">=</span><span class="token number">1.2</span> <span class="token comment">#少し多めに働ける</span>
    m <span class="token operator">+=</span> mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span>w<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&#x3C;=</span> r<span class="token operator">*</span>z
</code></pre>
<h3 id="交代が多すぎる問題"><a aria-hidden="true" tabindex="-1" href="#交代が多すぎる問題"><span class="icon icon-link"></span></a>交代が多すぎる問題</h3>
<p>30分単位でコマを取ったことで、30分単位で次々と部員が入れ替わるシフトが出来上がりました。誰も得しないので、最低連続1時間くらいは入るようにしたいなという気持ちがあり、それを制約に加えます。
具体的には <code class="language-math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><msub><mi>X</mi><msub><mi>t</mi><mi>n</mi></msub></msub><mo>+</mo><msub><mi>X</mi><msub><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></msub><mo>−</mo><msub><mi>X</mi><msub><mi>t</mi><mrow><mi>n</mi><mo>+</mo><mn>2</mn></mrow></msub></msub><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">-X_{t_n}+X_{t_{n+1}}-X_{t_{n+2}} \leq 0 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9334em;vertical-align:-0.2501em;"></span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9751em;vertical-align:-0.2918em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2918em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9751em;vertical-align:-0.2918em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2918em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></code> を制約に入れることで 0-1-0 の組み合わせを取る連続する3コマを禁止できます。</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tnum<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
            m <span class="token operator">+=</span> <span class="token operator">-</span>var_WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token operator">+</span>var_WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>var_WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&#x3C;=</span><span class="token number">0</span>
            <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token comment">#最初の場合、追加で1,0を禁止</span>
                m <span class="token operator">+=</span> var_WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token operator">-</span>var_WPT<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&#x3C;=</span><span class="token number">0</span>
</code></pre>
<h3 id="いろんなポジションにつきたい--できるだけ1つのポジションでいたい"><a aria-hidden="true" tabindex="-1" href="#いろんなポジションにつきたい--できるだけ1つのポジションでいたい"><span class="icon icon-link"></span></a>いろんなポジションにつきたい / できるだけ1つのポジションでいたい</h3>
<p>両意見出ました。個別にアンケートを取って、それぞれ対応します。</p>
<h4 id="いろんなポジションにつきたい"><a aria-hidden="true" tabindex="-1" href="#いろんなポジションにつきたい"><span class="icon icon-link"></span></a>いろんなポジションにつきたい</h4>
<p>新たに<code>Y[部員,ポジション]=そのポジションに入ることが1度でもあるか</code>のバイナリ変数行列を作成し、その合計値を目的関数に加えます。目的関数は最小化したい一方、これは大きいほど（多くの種類のポジションに入れるほど）嬉しいため、係数にマイナスがつきます。</p>
<pre class="language-python"><code class="language-python">Y<span class="token operator">=</span>m<span class="token punctuation">.</span>add_var_tensor<span class="token punctuation">(</span><span class="token punctuation">(</span>wnum<span class="token punctuation">,</span>pnum<span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">"in_WP"</span><span class="token punctuation">,</span>var_type<span class="token operator">=</span><span class="token string">"B"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>objective <span class="token operator">=</span> mip<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>
    <span class="token comment">#省略</span>
    <span class="token operator">-</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>Y<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># きるだけたくさんの場所に入れたい</span>
<span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

wnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"アリス"</span><span class="token punctuation">,</span><span class="token string">"キャロル"</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token punctuation">[</span>widx<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> wnames<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment"># widx()は部員名を入力して部員番号を出力</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m<span class="token operator">+=</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>=</span>Y<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">]</span> 
</code></pre>
<p><code>w</code>が希望者かつ<code>X[w,p,:] </code>に一つも1が立っていない場合（=そのポジションに1度も入らない場合）のみ、<code>sum(X[w,p,:])=0</code>となるので<code>Y[w,p]=0</code>になります。逆に、それ以外では<code>sum(Y[w,p])</code>を最大化する圧力がかかるため、<code>Y[w,p]=1</code>となります。</p>
<h4 id="できるだけ1つのポジションでいたい"><a aria-hidden="true" tabindex="-1" href="#できるだけ1つのポジションでいたい"><span class="icon icon-link"></span></a>できるだけ1つのポジションでいたい</h4>
<p><code>Y2[部員,ポジション]=そのポジションに入ることが1度でもあるか</code>のバイナリ変数行列を作成します。（<code>Y1</code>と異なり、こちらは目的関数に入れません）</p>
<pre class="language-python"><code class="language-python">Y2<span class="token operator">=</span>m<span class="token punctuation">.</span>add_var_tensor<span class="token punctuation">(</span><span class="token punctuation">(</span>wnum<span class="token punctuation">,</span>pnum<span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">"in_WP"</span><span class="token punctuation">,</span>var_type<span class="token operator">=</span><span class="token string">"B"</span><span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

wnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"ボブ"</span><span class="token punctuation">]</span>
M<span class="token operator">=</span><span class="token number">99999</span>
<span class="token keyword">for</span> w <span class="token keyword">in</span> <span class="token punctuation">[</span>widx<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> wnames<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>SC<span class="token punctuation">.</span>pnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
          m<span class="token operator">+=</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&#x3C;=</span>M<span class="token operator">*</span>Y2<span class="token punctuation">[</span>w<span class="token punctuation">,</span>p<span class="token punctuation">]</span>
      m<span class="token operator">+=</span>mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>Y2<span class="token punctuation">[</span>w<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span>

</code></pre>
<p><code>X[w,p,:] </code>に一つも1が立っていない場合、<code>sum(X[w,p,:])=0</code>より、<code>Y2[w,p]</code>は自由に値を取ることができます。逆に、1つでも1が立っている場合、<code>Y2[w,p]=0</code>では条件を満たさないので、<code>Y2[w,p]=1</code>と確定します。<br>
各部員ごとに<code>p</code>方向に圧縮した合計をとることによって、その部員が入るポジションの種類の上限を決めることが可能になります。（下限は決まらないことに注意。<code>sum(X[w,p,:])=0</code>だが<code>Y2[w,p]=1</code>なる変数の取り方は違法ではないため）</p>
<h3 id="特定時刻にのみ必要なシフト"><a aria-hidden="true" tabindex="-1" href="#特定時刻にのみ必要なシフト"><span class="icon icon-link"></span></a>特定時刻にのみ必要なシフト</h3>
<p>特定時刻にのみ必要なシフトの存在が発覚しました。色々考えた結果、別途「この時間にこのポジションのシフトが必要かどうか」の表をExcelで作り、「どの時間もどの場所もちゃんとシフトの人を入れる」制約をそれに合わせて変更する方針を取りました。</p>
<pre class="language-python"><code class="language-python">NeedsWorker<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data.xlsx'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>sheet_name<span class="token operator">=</span><span class="token string">'必要人数'</span><span class="token punctuation">)</span> 

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>tnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">+=</span> mip<span class="token punctuation">.</span>xsum<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>p<span class="token punctuation">,</span>t<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span>NeedsWorker<span class="token punctuation">[</span>p<span class="token punctuation">,</span>t<span class="token punctuation">]</span>
</code></pre>
<p>これにより、「朝の時間だけビラを配る」「企画全体でお昼休憩を取りたい（が来たお客さん向けに外に案内役が一人必要）」等の要望をかなえることができました。</p>
<h3 id="のポジションはベテランの部員にしか任せられない"><a aria-hidden="true" tabindex="-1" href="#のポジションはベテランの部員にしか任せられない"><span class="icon icon-link"></span></a>○○のポジションはベテランの部員にしか任せられない</h3>
<p>「任せられない」も「希望しない」も内部的には同じであることを利用してシフト希望調査の希望度を改ざんすることで事なきを得ました。</p>
<h2 id="定式化できなかった要望"><a aria-hidden="true" tabindex="-1" href="#定式化できなかった要望"><span class="icon icon-link"></span></a>定式化できなかった要望</h2>
<h3 id="立ち仕事は連続すると疲れるので適度に座り仕事を入れてほしい"><a aria-hidden="true" tabindex="-1" href="#立ち仕事は連続すると疲れるので適度に座り仕事を入れてほしい"><span class="icon icon-link"></span></a>立ち仕事は連続すると疲れるので、適度に座り仕事を入れてほしい</h3>
<p>気持ちが分かる一方でややあいまいな要望であり、「立ち仕事か座り仕事か」フラグを導入するのも面倒だったので最後に自分が確認して「ヨシ！」をやりました。</p>
<h3 id="3日間のシフトのうち1日は完全フリーにしてほしい"><a aria-hidden="true" tabindex="-1" href="#3日間のシフトのうち1日は完全フリーにしてほしい"><span class="icon icon-link"></span></a>3日間のシフトのうち、1日は完全フリーにしてほしい</h3>
<p>目視で人が余っていそうな日を選び、その人のその日の希望をすべて【×】にすることで解決しました。<br>
この記事を書いてる間に気づいたのですが、「できるだけ1つのポジションでいたい」と同じ方針で「シフトが1コマ以上入っている日が2日以内」という制約が書けます。</p>
<h3 id="ゆっくり来るか早く帰るかしたいのでシフトはどこかに固めてほしい--学祭を見て回りたいので長い休みが欲しい"><a aria-hidden="true" tabindex="-1" href="#ゆっくり来るか早く帰るかしたいのでシフトはどこかに固めてほしい--学祭を見て回りたいので長い休みが欲しい"><span class="icon icon-link"></span></a>ゆっくり来るか早く帰るかしたいのでシフトはどこかに固めてほしい / 学祭を見て回りたいので長い休みが欲しい</h3>
<p>目視でそれっぽいところの希望を【x】にすることで解決（？）。<br>
具体的に何時間かが分からない（他部員のシフト状況に依存する）ため、定式化できなかったです。何か良い方法があれば教えてください。</p>
<h2 id="その他技術的なこと"><a aria-hidden="true" tabindex="-1" href="#その他技術的なこと"><span class="icon icon-link"></span></a>その他技術的なこと</h2>
<h3 id="制約で書くか大きいコストを入れるか"><a aria-hidden="true" tabindex="-1" href="#制約で書くか大きいコストを入れるか"><span class="icon icon-link"></span></a>制約で書くか大きいコストを入れるか</h3>
<p>【×】と希望を出した時間やポジションは原則として入れないルールがありますが、これを実現するには2つの方法があります。
①制約条件として、【×】と希望を出したセルにビットが立つのを禁止する<br>
②非常に大きいコストを入れて目的関数を最小化する過程ではじいてもらう<br>
要は、変数が増えるのと制約が増えるので（or 2段階単体法の1段目が厳しい場合と2段目が厳しい場合とで（？））どちらが負担が少ないかという問題なのですが、双対問題に切り替わると変数と制約の数が逆転する上、そもそもoptmizerの内部でゴリゴリに最適化がかかっているためどちらが良いと一概に言える感じではなさそうです。体感としても、①のほうが早いタイミングと②のほうが早いタイミングがあり、ちゃんとした結論は出ませんでした。この辺の話に詳しい人がいたら教えていただきたいです。</p>
<h2 id="おわりに"><a aria-hidden="true" tabindex="-1" href="#おわりに"><span class="icon icon-link"></span></a>おわりに</h2>
<p>今回、数理最適化を使って現実の問題を解くということを初めて行いました。泥臭い調整が多く結構大変だったものの、楽しく開発できました。給与の発生しないボランティアの中、「すべての要望を通すと企画が成立しなくなる」というような心配をしていましたが、無事ちゃんと回るシフトができて安心しました。部員の皆さん、ご協力ありがとうございました。</p>
<p>一方、システム的にいくつか反省点があり、<br>
・要望が出るたびにコードを追加する必要があり、結果としてかなりの工数になったことに加え、他の人と分担することもできなかった（ほとんどの部員はコードが書けないため）。<br>
・定式化できない要望や、最後の細かい調整などで結果的に出来上がったシフト表に手を加える必要があった。<br>
・当日の体調不良に対して、代替が誰もいない　というような状況が起こった。<br>
・当日シフト担当者がダウンした際（案の定これが起こったのですが）のオペレーションが何も決まっておらず、上記の問題と合わせて現場の混乱のもとになった。<br>
等々、次回に向けた課題としたいです。</p></div></div></div></article></main></div><aside><div class="vstack gap-10 h-full"><div class="select-none vstack items-center gap-5 p-6 bg-primary-1"><div class="vstack items-center gap-2"><img src="../../assets/author.png" alt="avatar" class="object-cover w-28 h-28 rounded-full"/><h1 class="text-2xl font-semibold text-primary-1">Maltonn</h1></div><p class="text-primary-1">大阪大学工学部 電子情報工学科 B3</p><div class="flex gap-4"><a class="text-primary-1" aria-label="Github" href="https://github.com/maltonn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-primary-1" aria-label="Twitter" href="https://twitter.com/maltonn_"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a></div></div><div class="vstack gap-10 sticky top-20"><div class="select-none vstack gap-3 p-6 bg-primary-1"><div class="center gap-2 py-2 px-3 text-lg font-bold text-primary-1 uppercase"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"></path></svg>share</div><div class="w-full center gap-4"><button title="サークルのシフトを線形最適化で決める" aria-label="pinterest" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="40" height="40"><circle cx="32" cy="32" r="31" fill="#cb2128"></circle><path d="M32,16c-8.8,0-16,7.2-16,16c0,6.6,3.9,12.2,9.6,14.7c0-1.1,0-2.5,0.3-3.7 c0.3-1.3,2.1-8.7,2.1-8.7s-0.5-1-0.5-2.5c0-2.4,1.4-4.1,3.1-4.1c1.5,0,2.2,1.1,2.2,2.4c0,1.5-0.9,3.7-1.4,5.7 c-0.4,1.7,0.9,3.1,2.5,3.1c3,0,5.1-3.9,5.1-8.5c0-3.5-2.4-6.1-6.7-6.1c-4.9,0-7.9,3.6-7.9,7.7c0,1.4,0.4,2.4,1.1,3.1 c0.3,0.3,0.3,0.5,0.2,0.9c-0.1,0.3-0.3,1-0.3,1.3c-0.1,0.4-0.4,0.6-0.8,0.4c-2.2-0.9-3.3-3.4-3.3-6.1c0-4.5,3.8-10,11.4-10 c6.1,0,10.1,4.4,10.1,9.2c0,6.3-3.5,11-8.6,11c-1.7,0-3.4-0.9-3.9-2c0,0-0.9,3.7-1.1,4.4c-0.3,1.2-1,2.5-1.6,3.4 c1.4,0.4,3,0.7,4.5,0.7c8.8,0,16-7.2,16-16C48,23.2,40.8,16,32,16z" fill="white"></path></svg></button><button aria-label="twitter" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="40" height="40"><circle cx="32" cy="32" r="31" fill="#00aced"></circle><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z" fill="white"></path></svg></button><button title="サークルのシフトを線形最適化で決める" aria-label="facebook" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="40" height="40"><circle cx="32" cy="32" r="31" fill="#3b5998"></circle><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z" fill="white"></path></svg></button><button aria-label="line" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="40" height="40"><circle cx="32" cy="32" r="31" fill="#00b800"></circle><path d="M52.62 30.138c0 3.693-1.432 7.019-4.42 10.296h.001c-4.326 4.979-14 11.044-16.201 11.972-2.2.927-1.876-.591-1.786-1.112l.294-1.765c.069-.527.142-1.343-.066-1.865-.232-.574-1.146-.872-1.817-1.016-9.909-1.31-17.245-8.238-17.245-16.51 0-9.226 9.251-16.733 20.62-16.733 11.37 0 20.62 7.507 20.62 16.733zM27.81 25.68h-1.446a.402.402 0 0 0-.402.401v8.985c0 .221.18.4.402.4h1.446a.401.401 0 0 0 .402-.4v-8.985a.402.402 0 0 0-.402-.401zm9.956 0H36.32a.402.402 0 0 0-.402.401v5.338L31.8 25.858a.39.39 0 0 0-.031-.04l-.002-.003-.024-.025-.008-.007a.313.313 0 0 0-.032-.026.255.255 0 0 1-.021-.014l-.012-.007-.021-.012-.013-.006-.023-.01-.013-.005-.024-.008-.014-.003-.023-.005-.017-.002-.021-.003-.021-.002h-1.46a.402.402 0 0 0-.402.401v8.985c0 .221.18.4.402.4h1.446a.401.401 0 0 0 .402-.4v-5.337l4.123 5.568c.028.04.063.072.101.099l.004.003a.236.236 0 0 0 .025.015l.012.006.019.01a.154.154 0 0 1 .019.008l.012.004.028.01.005.001a.442.442 0 0 0 .104.013h1.446a.4.4 0 0 0 .401-.4v-8.985a.402.402 0 0 0-.401-.401zm-13.442 7.537h-3.93v-7.136a.401.401 0 0 0-.401-.401h-1.447a.4.4 0 0 0-.401.401v8.984a.392.392 0 0 0 .123.29c.072.068.17.111.278.111h5.778a.4.4 0 0 0 .401-.401v-1.447a.401.401 0 0 0-.401-.401zm21.429-5.287c.222 0 .401-.18.401-.402v-1.446a.401.401 0 0 0-.401-.402h-5.778a.398.398 0 0 0-.279.113l-.005.004-.006.008a.397.397 0 0 0-.111.276v8.984c0 .108.043.206.112.278l.005.006a.401.401 0 0 0 .284.117h5.778a.4.4 0 0 0 .401-.401v-1.447a.401.401 0 0 0-.401-.401h-3.93v-1.519h3.93c.222 0 .401-.18.401-.402V29.85a.401.401 0 0 0-.401-.402h-3.93V27.93h3.93z" fill="white"></path></svg></button><button aria-label="hatena" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="40" height="40"><circle cx="32" cy="32" r="31" fill="#009ad9"></circle><path d="M 36.164062 33.554688 C 34.988281 32.234375 33.347656 31.5 31.253906 31.34375 C 33.125 30.835938 34.476562 30.09375 35.335938 29.09375 C 36.191406 28.09375 36.609375 26.78125 36.609375 25.101562 C 36.628906 23.875 36.332031 22.660156 35.75 21.578125 C 35.160156 20.558594 34.292969 19.71875 33.253906 19.160156 C 32.304688 18.640625 31.175781 18.265625 29.847656 18.042969 C 28.523438 17.824219 26.195312 17.730469 22.867188 17.730469 L 14.769531 17.730469 L 14.769531 47.269531 L 23.113281 47.269531 C 26.46875 47.269531 28.886719 47.15625 30.367188 46.929688 C 31.851562 46.695312 33.085938 46.304688 34.085938 45.773438 C 35.289062 45.148438 36.28125 44.179688 36.933594 42.992188 C 37.597656 41.796875 37.933594 40.402344 37.933594 38.816406 C 37.933594 36.621094 37.347656 34.867188 36.164062 33.554688 Z M 22.257812 24.269531 L 23.984375 24.269531 C 25.988281 24.269531 27.332031 24.496094 28.015625 24.945312 C 28.703125 25.402344 29.042969 26.183594 29.042969 27.285156 C 29.042969 28.390625 28.664062 29.105469 27.9375 29.550781 C 27.210938 29.992188 25.84375 30.199219 23.855469 30.199219 L 22.257812 30.199219 Z M 29.121094 41.210938 C 28.328125 41.691406 26.976562 41.925781 25.078125 41.925781 L 22.257812 41.925781 L 22.257812 35.488281 L 25.195312 35.488281 C 27.144531 35.488281 28.496094 35.738281 29.210938 36.230469 C 29.925781 36.726562 30.304688 37.582031 30.304688 38.832031 C 30.304688 40.078125 29.914062 40.742188 29.105469 41.222656 Z M 29.121094 41.210938 M 46.488281 39.792969 C 44.421875 39.792969 42.742188 41.46875 42.742188 43.535156 C 42.742188 45.605469 44.421875 47.28125 46.488281 47.28125 C 48.554688 47.28125 50.230469 45.605469 50.230469 43.535156 C 50.230469 41.46875 48.554688 39.792969 46.488281 39.792969 Z M 46.488281 39.792969 M 43.238281 17.730469 L 49.738281 17.730469 L 49.738281 37.429688 L 43.238281 37.429688 Z M 43.238281 17.730469 " fill="white"></path></svg></button></div></div></div></div></aside></div></div></div><footer><div class="p-10 center bg-neutral-800 p-6"><div class="container xl:max-w-7xl mx-auto"><div class="vstack items-center gap-4"><div class="flex gap-4"><a class="text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100" aria-label="Github" href="https://github.com/maltonn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-neutral-200 hover:text-neutral-500 active:text-gray-600 transition duration-100" aria-label="Twitter" href="https://twitter.com/maltonn_"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a></div><div class="text-neutral-200 text-sm text-center">© 2022 - <!-- -->blog</div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"サークルのシフトを線形最適化で決める","date":"2023-11-22","slug":"004","content":"\u003ch2 id=\"tldr\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#tldr\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eTL;DR\u003c/h2\u003e\n\u003cp\u003e数理最適化を用いてシフトスケジューリング問題を解いたよ。多くの要望を考慮したシフトをシステマティックに作成することができたよ。\u003c/p\u003e\n\u003ch2 id=\"はじめに\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#はじめに\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\u003cp\u003e所属サークルの一つである大阪大学お嬢様部が学祭に出店することになり、そのシフト担当になりました。\nというわけで、前からやってみたかったシフトスケジューリング問題の実践投入をしてみました。\u003cbr\u003e\nなお、個人情報保護や説明のしやすさの観点から、一部詳細を変更しています。\u003c/p\u003e\n\u003ch2 id=\"お嬢様部とは\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#お嬢様部とは\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eお嬢様部とは\u003c/h2\u003e\n\u003cp\u003eもともとはtwitter上で語尾に「～ですわ」を付けるだけの小規模ネットミームでしたが、とある阪大生が「本当にサークルとして存在したら面白くね？」と思いついて大阪大学お嬢様部が生まれました。順調に運営が続き、現在アクティブ部員30名越えの中堅サークルにまで発展しています。大阪大学お嬢様部について詳しくは\u003ca href=\"https://twitter.com/OU_ojousamaclub\"\u003eTwitter\u003c/a\u003e もしくは \u003ca href=\"https://ou-ojousamaclub.com/\"\u003e公式ホームページ\u003c/a\u003eをご覧ください。\u003cbr\u003e\n余談ですが弊大学以外の名を冠したお嬢様部もたくさん存在します。よかったら調べてみてください。\u003c/p\u003e\n\u003ch2 id=\"線形最適化線形計画法とは\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#線形最適化線形計画法とは\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e線形最適化(線形計画法)とは\u003c/h2\u003e\n\u003cp\u003e\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmi\u003eb\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ea_1x_1+a_2x_2+....a_nx_n \\leq b\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.786em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e....\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003cbr\u003e\nという条件（複数あってもよい）のもとで\u003cbr\u003e\n\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e.\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/msub\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eE= c_1x_1+c_2x_2+...c_mx_m\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eE\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e...\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003cbr\u003e\nを最小化する問題を解くことです。\u003cbr\u003e\nNP困難な問題ですが、単体法・内点法などのヒューリスティックアルゴリズムで現実的に高速に解くことができます。\u003c/p\u003e\n\u003cp\u003eなお、一部の変数が整数でなければならないという制約があると「混合整数線形計画問題（MIP）」と呼ばれる問題となり、今回もこれにあたります。 具体的にシフトをどのように不等式に落とし込むかは後述。\u003c/p\u003e\n\u003ch2 id=\"前提知識\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#前提知識\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e前提知識\u003c/h2\u003e\n\u003cp\u003e弊サークルでは部員がロールプレイをしてお客様をもてなすのですが、それゆえ、少し複雑な要件があります。\n\u003cimg src=\"../../assets/blog/004/1.png\" alt=\"部員-ロール-ポジションの関係\"\u003e\n部員にはそれぞれ、ロールの希望とポジションの希望があり、また、企画のコンセプトとして「このポジションにはこのロールを当てたい」というような運営側の希望があります。さらに、【この時間は全員が執事です】みたいな時間が出来ちゃうとギャグなので避けたい、というようなアンチパターンがいくつかあり考慮に入れる必要があります。\u003cbr\u003e\n人の手でこれらを総合してうまいこと組むのは至難の業であり、ここで数理最適化の強みが出ます。\u003c/p\u003e\n\u003ch2 id=\"開発\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#開発\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e開発\u003c/h2\u003e\n\u003ch3 id=\"データの用意\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#データの用意\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eデータの用意\u003c/h3\u003e\n\u003cp\u003eGoogle Form でシフト希望アンケートを取ったのち、Excelに落とし込みます。ポジション/ロールの希望については選択式なので簡単ですが、時間の希望については自由記述を定型データに落とし込む必要がありそれなりに骨が折れる作業でした。次回以降の課題の一つです。\n\u003cimg src=\"../../assets/blog/004/2.png\" alt=\"希望調査表\"\u003e\n時間/ロール/ポジションの希望調査に運営から聞いたレギュレーションを追加して4つの表が出来上がりました。\u003cbr\u003e\nなお、実際には30部員・20時間（40コマ）・13ポジション・4ロールを扱う必要があり、それなりに大きな表になります。\u003c/p\u003e\n\u003ch3 id=\"コストの定義\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#コストの定義\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eコストの定義\u003c/h3\u003e\n\u003cp\u003epandasにはExcelの表を読みだしてそのままDataFrameにしてくれる機能があります。そこからさらにndarrayに変換して、○△×を適切なコストで置換してやれば\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eW\u003c/mi\u003e\u003cmi\u003eP\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e[\u003c/mo\u003e\u003cmtext\u003e部員番号\u003c/mtext\u003e\u003cmo stretchy=\"false\"\u003e]\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e[\u003c/mo\u003e\u003cmtext\u003eポジション\u003c/mtext\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmi\u003eD\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e]\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmtext\u003eコスト\u003c/mtext\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eWP[部員番号][ポジションID]=コスト\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eW\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eP\u003c/span\u003e\u003cspan class=\"mopen\"\u003e[\u003c/span\u003e\u003cspan class=\"mord cjk_fallback\"\u003e部員番号\u003c/span\u003e\u003cspan class=\"mclose\"\u003e]\u003c/span\u003e\u003cspan class=\"mopen\"\u003e[\u003c/span\u003e\u003cspan class=\"mord cjk_fallback\"\u003eポジション\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eD\u003c/span\u003e\u003cspan class=\"mclose\"\u003e]\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord cjk_fallback\"\u003eコスト\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003eとなるようなコスト表が出来上がります。他の要素についても同様。\u003cbr\u003e\n後から出てきますが、シフト計画はこれらの合計を最小化するように立てるので、【〇】のコストを小さく、【×】のコストを大きくするのが良いです。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e pd\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\nWP_df \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e pd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread_excel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'data.xlsx'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e index_col\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003esheet_name\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'ポジション'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nWP \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e WP_df\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003evalues\nWP\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eWP\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"〇\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\nWP\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eWP\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"△\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\nWP\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eWP\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"×\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e10000000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこれらの積を取って、部員・ポジション・ロール・時間が与えられたときのコスト行列を定義します。\nやや効率の悪いやり方をしているように思えますが、せいぜい部員×ポジション×時間の\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e4\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e10^4\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e4\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003eオーダーしか回らないこと、実際には細かい要望に合わせてcost関数を変更する必要があること等が理由でこの形に落ち着きました。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecost\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e w\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e p\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWP\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRP\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003er\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\nWPT\u003cspan class=\"token operator\"\u003e=\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e p \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecost\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003erole_WD\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime2day\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e目ざとい読者はお気づきかもしれませんが、コスト行列にロール要素が含まれていません。これは、当初WPRTの4軸で実装したところ変数と条件の数があまりに多く一向に有効解が見つからなかったため、諦めてロールを決め打ちしたという事情があります。（role_WDがこれにあたり、\u003ccode\u003erole_WD[部員番号,企画日何日目か] = その日のロール\u003c/code\u003e）なる行列をあらかじめ定義しました。）\u003c/p\u003e\n\u003ch3 id=\"モデルの作成と変数定義と\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#モデルの作成と変数定義と\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eモデルの作成と変数定義と\u003c/h3\u003e\n\u003cp\u003epython-MIPを使ってモデルと変数を作ります。\n（説明の見やすさのため、変数名を一文字にしていますが実際は\u003ccode\u003evar_WPT\u003c/code\u003eみたいな名前を付けてます。命名のベストプラクティスはなんも分らん）\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mip\nm\u003cspan class=\"token operator\"\u003e=\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ShiftScheduling\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nX\u003cspan class=\"token operator\"\u003e=\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eadd_var_tensor\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"worker-place-time\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003evar_type\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003epython-MIPではadd_var_tensorメソッドによって多次元配列の変数集合を作ることができます。\n今回は 部員番号を\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ew\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ew\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e,ポジション番号を\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ep\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ep\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ep\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e,時間セクション番号を\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003et\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6151em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003eとして、\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e[\u003c/mo\u003e\u003cmi\u003ew\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e]\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmrow\u003e\u003cmo fence=\"true\"\u003e{\u003c/mo\u003e\u003cmtable rowspacing=\"0.36em\" columnalign=\"left left\" columnspacing=\"1em\"\u003e\u003cmtr\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"false\"\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"false\"\u003e\u003cmtext\u003eその部員がその時間にそのポジションに入る場合\u003c/mtext\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003cmtr\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"false\"\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"false\"\u003e\u003cmtext\u003eotherwise\u003c/mtext\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003c/mtable\u003e\u003c/mrow\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eX[w,p,t] = \\begin{cases} 1 \u0026#x26; \\text{その部員がその時間にそのポジションに入る場合} \\\\0 \u0026#x26; \\text{otherwise}\\end{cases}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"mopen\"\u003e[\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02691em;\"\u003ew\u003c/span\u003e\u003cspan class=\"mpunct\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ep\u003c/span\u003e\u003cspan class=\"mpunct\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003cspan class=\"mclose\"\u003e]\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:3em;vertical-align:-1.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"minner\"\u003e\u003cspan class=\"mopen delimcenter\" style=\"top:0em;\"\u003e\u003cspan class=\"delimsizing size4\"\u003e{\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mtable\"\u003e\u003cspan class=\"col-align-l\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.69em;\"\u003e\u003cspan style=\"top:-3.69em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.008em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.25em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.008em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.19em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"arraycolsep\" style=\"width:1em;\"\u003e\u003c/span\u003e\u003cspan class=\"col-align-l\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.69em;\"\u003e\u003cspan style=\"top:-3.69em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.008em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord cjk_fallback\"\u003eその部員がその時間にそのポジションに入る場合\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-2.25em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.008em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eotherwise\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.19em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e  なる変数行列をつくりました。これにより、各種条件をシンプルに書くことが可能になります。　　\u003c/p\u003e\n\u003ch3 id=\"目的関数\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#目的関数\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e目的関数\u003c/h3\u003e\n\u003cp\u003e各セルのコストと変数が決まったため、線形計画問題に落とし込む準備ができました。\n今回は\u003ccode\u003eE= X*SC.WPT\u003c/code\u003eの合計値の最小化を目指します。これはすなわち、\u003ccode\u003eX[w,p,t]==1\u003c/code\u003eとなる（＝部員\u003ccode\u003ew\u003c/code\u003eがポジション\u003ccode\u003ep\u003c/code\u003e、時刻\u003ccode\u003et\u003c/code\u003eでポジションに入るときの）\u003ccode\u003ew,p,t\u003c/code\u003eのコストの合計値を最小化する事と同義です。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eobjective \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eminimize\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eSC\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWPT\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"制約条件\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#制約条件\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e制約条件\u003c/h3\u003e\n\u003cp\u003eこのままでは、「全時間誰も入らないのがコスト0で一番いいね！」となってしまします。そういうわけにはいかないので、必要な制約条件を追加してきます。\npython-MIPでは\u003ccode\u003em+=条件\u003c/code\u003eという形で制約条件を追加することができます。かなり思いきった演算子オーバーロードです。\u003c/p\u003e\n\u003ch4 id=\"どの時間もどの場所もちゃんとシフトの人を入れる\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#どの時間もどの場所もちゃんとシフトの人を入れる\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eどの時間もどの場所もちゃんとシフトの人を入れる\u003c/h4\u003e\n\u003cp\u003e「すべての時間tとポジションpについて、w方向に圧縮した場合（部員を問わない場合）常に1となる」と読みかえて式に落とします。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e  \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e p \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"一人二役の禁止\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#一人二役の禁止\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e一人二役の禁止\u003c/h4\u003e\n\u003cp\u003eある時間に同じ人が異なる2か所のポジションに入ってしまうと大変なことになります。制約条件として「任意の時間t,部員wについて\u003ccode\u003eX[w,p,t]=1\u003c/code\u003eなるpは最大一つ」⇔「p方向に圧縮した合計値が1以下」を追加します。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"完成\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#完成\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e完成！\u003c/h3\u003e\n\u003cp\u003e破綻のないシフト計画が完成しました！\u003cbr\u003e\n（実際のシフトは個人情報保護のため割愛）\u003c/p\u003e\n\u003ch2 id=\"要望とかに答えるフェーズ\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#要望とかに答えるフェーズ\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e要望とかに答えるフェーズ\u003c/h2\u003e\n\u003cp\u003e出来上がったシフト表をよく見ると色々と文句の付け所があることに気づきます。この節では文句/要望とそれにどう対応したかを紹介します。\u003c/p\u003e\n\u003ch3 id=\"全員執事みたいなギャグを避けるために\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#全員執事みたいなギャグを避けるために\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e「全員執事」みたいなギャグを避けるために\u003c/h3\u003e\n\u003cp\u003e任意の時間で、どこかのポジションはお嬢様ロールが入っていなくてはならないという制約を追加します。お嬢様ロールの部員のみを抜き取って、時間を固定したときの合計が1以上になればよいです。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    ojousama_lst\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e role_WD\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et2d\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e==\u003c/span\u003eridx\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"お嬢様\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    m\u003cspan class=\"token operator\"\u003e+=\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eojousama_lst\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eリストをインデックスにできるnumpy式スライシングの便利さに感動。\u003c/p\u003e\n\u003ch3 id=\"連続時間制約\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#連続時間制約\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e連続時間制約\u003c/h3\u003e\n\u003cp\u003e機械は感情がないので、「部員によっては1日中休憩なし」みたいな血も涙もないシフトを出してきます。そこで、3時間以上連続でシフトに入れることを禁止する制約を付けます。\n30分1コマなので任意の時刻\u003ccode\u003et\u003c/code\u003eにおいて\u003ccode\u003et\u003c/code\u003eから\u003ccode\u003et+6\u003c/code\u003eまでの合計値が5以下であればよいです。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etnum\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        m\u003cspan class=\"token operator\"\u003e+=\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003evar_WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003et\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e6\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"さんだけ働かせすぎじゃない問題\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#さんだけ働かせすぎじゃない問題\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e○○さんだけ働かせすぎじゃない？問題\u003c/h3\u003e\n\u003cp\u003eシフト時間ができるだけ公平になるような制約/目的関数を追加します。\u003cbr\u003e\nできるだけ公平と聞いてまず思いつくのは分散最小化ですが、これはXについての2次式となり、目的関数や制約条件に落とし込むことができません。そこで、「最もシフトに長くいる人のシフト入り時間の最小化」をすることで、不公平に働きすぎる人を抑えようというアプローチをとります。\u003cbr\u003e\n最小値の最大化は線形計画法の鉄板テクニックで、新たな中間変数zを用意して\u003cbr\u003e\n\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmtext\u003eminimize: \u003c/mtext\u003e\u003cmi\u003emax\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmrow\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003eY\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{minimize: } \\max{(Y_n)}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eminimize: \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop\"\u003emax\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003cbr\u003e\n\u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e⇔\u003c/mo\u003e\u003cmtext\u003eminimize: \u003c/mtext\u003e\u003cmi\u003ez\u003c/mi\u003e\u003cmtext\u003e subject to \u003c/mtext\u003e\u003cmsub\u003e\u003cmi\u003eY\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmi\u003ez\u003c/mi\u003e\u003cmtext\u003e for all \u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\Leftrightarrow \\text{minimize: } z \\text{ subject to } Y_n \\leq z \\text{ for all } n\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.3669em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e⇔\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003eminimize: \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\"\u003ez\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003e subject to \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.04398em;\"\u003ez\u003c/span\u003e\u003cspan class=\"mord text\"\u003e\u003cspan class=\"mord\"\u003e for all \u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003cbr\u003e\nと読み替えることで線形式に落とし込めます。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003ez\u003cspan class=\"token operator\"\u003e=\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eadd_var\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"max_shift_time\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003evar_type\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"I\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eobjective \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eminimize\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n                  mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eSC\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWPT\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n                \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e z \u003cspan class=\"token comment\"\u003e#新たに導入する中間変数\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e z\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eまた、重みを付けて一部の部員の制限を緩くしたり厳しくしたりもできます。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    r\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e w\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \n        r\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e1.2\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#少し多めに働ける\u003c/span\u003e\n    m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e r\u003cspan class=\"token operator\"\u003e*\u003c/span\u003ez\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"交代が多すぎる問題\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#交代が多すぎる問題\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e交代が多すぎる問題\u003c/h3\u003e\n\u003cp\u003e30分単位でコマを取ったことで、30分単位で次々と部員が入れ替わるシフトが出来上がりました。誰も得しないので、最低連続1時間くらいは入るようにしたいなという気持ちがあり、それを制約に加えます。\n具体的には \u003ccode class=\"language-math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/msub\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmsub\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/msub\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e-X_{t_n}+X_{t_{n+1}}-X_{t_{n+2}} \\leq 0 \u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.9334em;vertical-align:-0.2501em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e−\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2806em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1645em;\"\u003e\u003cspan style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.5em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size3 size1 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.143em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2501em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.9751em;vertical-align:-0.2918em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2806em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3173em;\"\u003e\u003cspan style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.5em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size3 size1 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2025em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2918em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.9751em;vertical-align:-0.2918em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2806em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3173em;\"\u003e\u003cspan style=\"top:-2.357em;margin-left:0em;margin-right:0.0714em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.5em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size3 size1 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2025em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2918em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e を制約に入れることで 0-1-0 の組み合わせを取る連続する3コマを禁止できます。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etnum\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e p \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003evar_WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e+\u003c/span\u003evar_WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003evar_WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e t\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token comment\"\u003e#最初の場合、追加で1,0を禁止\u003c/span\u003e\n                m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e var_WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003evar_WPT\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"いろんなポジションにつきたい--できるだけ1つのポジションでいたい\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#いろんなポジションにつきたい--できるだけ1つのポジションでいたい\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eいろんなポジションにつきたい / できるだけ1つのポジションでいたい\u003c/h3\u003e\n\u003cp\u003e両意見出ました。個別にアンケートを取って、それぞれ対応します。\u003c/p\u003e\n\u003ch4 id=\"いろんなポジションにつきたい\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#いろんなポジションにつきたい\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eいろんなポジションにつきたい\u003c/h4\u003e\n\u003cp\u003e新たに\u003ccode\u003eY[部員,ポジション]=そのポジションに入ることが1度でもあるか\u003c/code\u003eのバイナリ変数行列を作成し、その合計値を目的関数に加えます。目的関数は最小化したい一方、これは大きいほど（多くの種類のポジションに入れるほど）嬉しいため、係数にマイナスがつきます。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003eY\u003cspan class=\"token operator\"\u003e=\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eadd_var_tensor\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"in_WP\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003evar_type\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nm\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eobjective \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eminimize\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e#省略\u003c/span\u003e\n    \u003cspan class=\"token operator\"\u003e-\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eY\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eflatten\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# きるだけたくさんの場所に入れたい\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\nwnames\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"アリス\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"キャロル\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ewidx\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e wnames\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token comment\"\u003e# widx()は部員名を入力して部員番号を出力\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e p \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        m\u003cspan class=\"token operator\"\u003e+=\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003eY\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ew\u003c/code\u003eが希望者かつ\u003ccode\u003eX[w,p,:] \u003c/code\u003eに一つも1が立っていない場合（=そのポジションに1度も入らない場合）のみ、\u003ccode\u003esum(X[w,p,:])=0\u003c/code\u003eとなるので\u003ccode\u003eY[w,p]=0\u003c/code\u003eになります。逆に、それ以外では\u003ccode\u003esum(Y[w,p])\u003c/code\u003eを最大化する圧力がかかるため、\u003ccode\u003eY[w,p]=1\u003c/code\u003eとなります。\u003c/p\u003e\n\u003ch4 id=\"できるだけ1つのポジションでいたい\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#できるだけ1つのポジションでいたい\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eできるだけ1つのポジションでいたい\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eY2[部員,ポジション]=そのポジションに入ることが1度でもあるか\u003c/code\u003eのバイナリ変数行列を作成します。（\u003ccode\u003eY1\u003c/code\u003eと異なり、こちらは目的関数に入れません）\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003eY2\u003cspan class=\"token operator\"\u003e=\u003c/span\u003em\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eadd_var_tensor\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ewnum\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ename\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"in_WP\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003evar_type\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"B\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\nwnames\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"ボブ\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\nM\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e99999\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e w \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ewidx\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e wnames\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e p \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSC\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          m\u003cspan class=\"token operator\"\u003e+=\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003eM\u003cspan class=\"token operator\"\u003e*\u003c/span\u003eY2\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n      m\u003cspan class=\"token operator\"\u003e+=\u003c/span\u003emip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eY2\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ew\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e==\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eX[w,p,:] \u003c/code\u003eに一つも1が立っていない場合、\u003ccode\u003esum(X[w,p,:])=0\u003c/code\u003eより、\u003ccode\u003eY2[w,p]\u003c/code\u003eは自由に値を取ることができます。逆に、1つでも1が立っている場合、\u003ccode\u003eY2[w,p]=0\u003c/code\u003eでは条件を満たさないので、\u003ccode\u003eY2[w,p]=1\u003c/code\u003eと確定します。\u003cbr\u003e\n各部員ごとに\u003ccode\u003ep\u003c/code\u003e方向に圧縮した合計をとることによって、その部員が入るポジションの種類の上限を決めることが可能になります。（下限は決まらないことに注意。\u003ccode\u003esum(X[w,p,:])=0\u003c/code\u003eだが\u003ccode\u003eY2[w,p]=1\u003c/code\u003eなる変数の取り方は違法ではないため）\u003c/p\u003e\n\u003ch3 id=\"特定時刻にのみ必要なシフト\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#特定時刻にのみ必要なシフト\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e特定時刻にのみ必要なシフト\u003c/h3\u003e\n\u003cp\u003e特定時刻にのみ必要なシフトの存在が発覚しました。色々考えた結果、別途「この時間にこのポジションのシフトが必要かどうか」の表をExcelで作り、「どの時間もどの場所もちゃんとシフトの人を入れる」制約をそれに合わせて変更する方針を取りました。\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003eNeedsWorker\u003cspan class=\"token operator\"\u003e=\u003c/span\u003epd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread_excel\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'data.xlsx'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e index_col\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003esheet_name\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token string\"\u003e'必要人数'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n\n\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e t \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e p \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epnum\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        m \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e mip\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003exsum\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003eNeedsWorker\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこれにより、「朝の時間だけビラを配る」「企画全体でお昼休憩を取りたい（が来たお客さん向けに外に案内役が一人必要）」等の要望をかなえることができました。\u003c/p\u003e\n\u003ch3 id=\"のポジションはベテランの部員にしか任せられない\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#のポジションはベテランの部員にしか任せられない\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e○○のポジションはベテランの部員にしか任せられない\u003c/h3\u003e\n\u003cp\u003e「任せられない」も「希望しない」も内部的には同じであることを利用してシフト希望調査の希望度を改ざんすることで事なきを得ました。\u003c/p\u003e\n\u003ch2 id=\"定式化できなかった要望\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#定式化できなかった要望\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e定式化できなかった要望\u003c/h2\u003e\n\u003ch3 id=\"立ち仕事は連続すると疲れるので適度に座り仕事を入れてほしい\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#立ち仕事は連続すると疲れるので適度に座り仕事を入れてほしい\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e立ち仕事は連続すると疲れるので、適度に座り仕事を入れてほしい\u003c/h3\u003e\n\u003cp\u003e気持ちが分かる一方でややあいまいな要望であり、「立ち仕事か座り仕事か」フラグを導入するのも面倒だったので最後に自分が確認して「ヨシ！」をやりました。\u003c/p\u003e\n\u003ch3 id=\"3日間のシフトのうち1日は完全フリーにしてほしい\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#3日間のシフトのうち1日は完全フリーにしてほしい\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e3日間のシフトのうち、1日は完全フリーにしてほしい\u003c/h3\u003e\n\u003cp\u003e目視で人が余っていそうな日を選び、その人のその日の希望をすべて【×】にすることで解決しました。\u003cbr\u003e\nこの記事を書いてる間に気づいたのですが、「できるだけ1つのポジションでいたい」と同じ方針で「シフトが1コマ以上入っている日が2日以内」という制約が書けます。\u003c/p\u003e\n\u003ch3 id=\"ゆっくり来るか早く帰るかしたいのでシフトはどこかに固めてほしい--学祭を見て回りたいので長い休みが欲しい\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#ゆっくり来るか早く帰るかしたいのでシフトはどこかに固めてほしい--学祭を見て回りたいので長い休みが欲しい\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eゆっくり来るか早く帰るかしたいのでシフトはどこかに固めてほしい / 学祭を見て回りたいので長い休みが欲しい\u003c/h3\u003e\n\u003cp\u003e目視でそれっぽいところの希望を【x】にすることで解決（？）。\u003cbr\u003e\n具体的に何時間かが分からない（他部員のシフト状況に依存する）ため、定式化できなかったです。何か良い方法があれば教えてください。\u003c/p\u003e\n\u003ch2 id=\"その他技術的なこと\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#その他技術的なこと\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eその他技術的なこと\u003c/h2\u003e\n\u003ch3 id=\"制約で書くか大きいコストを入れるか\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#制約で書くか大きいコストを入れるか\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e制約で書くか大きいコストを入れるか\u003c/h3\u003e\n\u003cp\u003e【×】と希望を出した時間やポジションは原則として入れないルールがありますが、これを実現するには2つの方法があります。\n①制約条件として、【×】と希望を出したセルにビットが立つのを禁止する\u003cbr\u003e\n②非常に大きいコストを入れて目的関数を最小化する過程ではじいてもらう\u003cbr\u003e\n要は、変数が増えるのと制約が増えるので（or 2段階単体法の1段目が厳しい場合と2段目が厳しい場合とで（？））どちらが負担が少ないかという問題なのですが、双対問題に切り替わると変数と制約の数が逆転する上、そもそもoptmizerの内部でゴリゴリに最適化がかかっているためどちらが良いと一概に言える感じではなさそうです。体感としても、①のほうが早いタイミングと②のほうが早いタイミングがあり、ちゃんとした結論は出ませんでした。この辺の話に詳しい人がいたら教えていただきたいです。\u003c/p\u003e\n\u003ch2 id=\"おわりに\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#おわりに\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eおわりに\u003c/h2\u003e\n\u003cp\u003e今回、数理最適化を使って現実の問題を解くということを初めて行いました。泥臭い調整が多く結構大変だったものの、楽しく開発できました。給与の発生しないボランティアの中、「すべての要望を通すと企画が成立しなくなる」というような心配をしていましたが、無事ちゃんと回るシフトができて安心しました。部員の皆さん、ご協力ありがとうございました。\u003c/p\u003e\n\u003cp\u003e一方、システム的にいくつか反省点があり、\u003cbr\u003e\n・要望が出るたびにコードを追加する必要があり、結果としてかなりの工数になったことに加え、他の人と分担することもできなかった（ほとんどの部員はコードが書けないため）。\u003cbr\u003e\n・定式化できない要望や、最後の細かい調整などで結果的に出来上がったシフト表に手を加える必要があった。\u003cbr\u003e\n・当日の体調不良に対して、代替が誰もいない　というような状況が起こった。\u003cbr\u003e\n・当日シフト担当者がダウンした際（案の定これが起こったのですが）のオペレーションが何も決まっておらず、上記の問題と合わせて現場の混乱のもとになった。\u003cbr\u003e\n等々、次回に向けた課題としたいです。\u003c/p\u003e","ogImage":{"url":"/assets/blog/004/thumbnail.png"},"coverImage":"/assets/blog/004/thumbnail.png","excerpt":"python-MIPを用いたシフトスケジューリング最適化","tags":["開発","pickup"]}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"004"},"buildId":"itYJbJc-on64ttulGuxbe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>